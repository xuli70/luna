version: '3.8'
services:
  luna-app:
    image: node:22-alpine
    working_dir: /app
    environment:
      - NODE_ENV=production
      - NPM_CONFIG_PRODUCTION=false
    command: >
      sh -c "
        echo 'Instalando git...' &&
        apk add --no-cache git &&
        echo 'Clonando repositorio...' &&
        git clone https://github.com/xuli70/luna.git /tmp/luna &&
        cd /tmp/luna &&
        echo 'Instalando dependencias...' &&
        npm install &&
        echo 'Ejecutando build...' &&
        npm run build:prod &&
        echo 'Build completado exitosamente!' &&
        echo 'Archivos generados:' &&
        ls -la dist/ &&
        echo 'Iniciando servidor web...' &&
        cd dist &&
        python3 -m http.server 5173 --bind 0.0.0.0
      "
    ports:
      - "3000:5173"
    expose:
      - "5173"